<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>URL Safety Check – CyberScan</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .transition-theme {
      transition: background-color 0.4s ease, color 0.4s ease;
    }
  </style>
</head>
<body id="body" class="bg-gray-900 text-white flex flex-col items-center min-h-screen p-6 gap-6 font-mono transition-theme">
  <a href="index.html" class="self-start text-gray-400 hover:text-white">← Back</a>
  <h1 class="text-4xl font-bold">🔗 CyberScan – URL Safety Check</h1>

  <!-- Info Box -->
  <div id="infoBox" class="bg-gray-800 text-sm p-4 rounded-xl max-w-2xl text-gray-300 transition-theme">
    <p>🔍 Enter a full URL including <code>http://</code> or <code>https://</code> to check if it's flagged as unsafe by Google's Safe Browsing API.</p>
    <p class="mt-2">🧪 Test unsafe URL: <code>http://malware.testing.google.test/testing/malware/</code></p>
  </div>

  <!-- Input Form -->
  <div class="w-full max-w-xl flex flex-col gap-4">
    <input id="urlInput" type="url" placeholder="https://example.com" class="p-3 rounded-xl text-black" />
    <button onclick="checkUrl()" id="scanBtn" class="bg-gray-700 hover:bg-gray-800 py-3 rounded-xl shadow-lg font-semibold transition-theme">
      Scan URL
    </button>
    <div id="result" class="text-lg font-bold min-h-[2rem]"></div>
  </div>

  <!-- Details Output -->
  <div id="detailsBox" class="hidden w-full max-w-2xl mt-4 bg-gray-800 text-white p-4 rounded-xl shadow-lg space-y-2 transition-theme"></div>

  <script>
    const API_KEY = 'AIzaSyD1N9V3fedrSj7lZL9ylv6ZETYascbhRso';

    function isValidUrl(str) {
      try {
        const url = new URL(str);
        return url.protocol === "http:" || url.protocol === "https:";
      } catch (_) {
        return false;
      }
    }

    function setThemeSafe() {
      document.getElementById('body').className = 'bg-green-950 text-white flex flex-col items-center min-h-screen p-6 gap-6 font-mono transition-theme';
      document.getElementById('scanBtn').className = 'bg-green-600 hover:bg-green-700 py-3 rounded-xl shadow-lg font-semibold transition-theme';
      document.getElementById('infoBox').className = 'bg-green-900 text-sm p-4 rounded-xl max-w-2xl text-green-200 transition-theme';
      document.getElementById('detailsBox').className = 'w-full max-w-2xl mt-4 bg-green-900 text-white p-4 rounded-xl shadow-lg space-y-2 transition-theme';
    }

    function setThemeUnsafe() {
      document.getElementById('body').className = 'bg-red-950 text-white flex flex-col items-center min-h-screen p-6 gap-6 font-mono transition-theme';
      document.getElementById('scanBtn').className = 'bg-red-600 hover:bg-red-700 py-3 rounded-xl shadow-lg font-semibold transition-theme';
      document.getElementById('infoBox').className = 'bg-red-900 text-sm p-4 rounded-xl max-w-2xl text-red-200 transition-theme';
      document.getElementById('detailsBox').className = 'w-full max-w-2xl mt-4 bg-red-900 text-white p-4 rounded-xl shadow-lg space-y-2 transition-theme';
    }

    function resetTheme() {
      document.getElementById('body').className = 'bg-gray-900 text-white flex flex-col items-center min-h-screen p-6 gap-6 font-mono transition-theme';
      document.getElementById('scanBtn').className = 'bg-gray-700 hover:bg-gray-800 py-3 rounded-xl shadow-lg font-semibold transition-theme';
      document.getElementById('infoBox').className = 'bg-gray-800 text-sm p-4 rounded-xl max-w-2xl text-gray-300 transition-theme';
      document.getElementById('detailsBox').className = 'w-full max-w-2xl mt-4 bg-gray-800 text-white p-4 rounded-xl shadow-lg space-y-2 transition-theme';
    }

    async function checkUrl() {
      const url = document.getElementById('urlInput').value.trim();
      const resultEl = document.getElementById('result');
      const detailsEl = document.getElementById('detailsBox');

      detailsEl.classList.add('hidden');
      detailsEl.innerHTML = '';
      resultEl.textContent = '';
      resetTheme();

      if (!url) {
        resultEl.textContent = '⚠️ Please enter a URL';
        resultEl.className = 'text-yellow-400 font-bold';
        return;
      }

      if (!isValidUrl(url)) {
        resultEl.textContent = '❌ Invalid URL. Must start with http:// or https://';
        resultEl.className = 'text-red-400 font-bold';
        return;
      }

      resultEl.textContent = '⏳ Scanning URL… Please wait';
      resultEl.className = 'text-white font-bold';

      const body = {
        client: { clientId: 'cyberscan', clientVersion: '1.0' },
        threatInfo: {
          threatTypes: ['MALWARE', 'SOCIAL_ENGINEERING', 'UNWANTED_SOFTWARE', 'POTENTIALLY_HARMFUL_APPLICATION'],
          platformTypes: ['ANY_PLATFORM'],
          threatEntryTypes: ['URL'],
          threatEntries: [{ url }]
        }
      };

      try {
        const res = await fetch(`https://safebrowsing.googleapis.com/v4/threatMatches:find?key=${API_KEY}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });

        const data = await res.json();

        if (data && data.matches && data.matches.length > 0) {
          const match = data.matches[0];
          resultEl.textContent = '❗ This URL is unsafe!';
          resultEl.className = 'text-red-400 font-bold';
          setThemeUnsafe();

          detailsEl.innerHTML = `
            <p><strong>🛑 Threat Type:</strong> ${match.threatType}</p>
            <p><strong>🧱 Platform:</strong> ${match.platformType}</p>
            <p><strong>🔍 Entry Type:</strong> ${match.threatEntryType}</p>
            <p><strong>🔗 Scanned URL:</strong> ${match.threat.url}</p>
          `;
        } else {
          resultEl.textContent = '✅ This URL is safe. No threats were found.';
          resultEl.className = 'text-green-400 font-bold';
          setThemeSafe();

          detailsEl.innerHTML = `
            <p><strong>✅ No issues found for:</strong> ${url}</p>
            <p>This site has not been flagged for malware, phishing, or other known online threats.</p>
          `;
        }

        detailsEl.classList.remove('hidden');
      } catch (err) {
        resultEl.textContent = '❌ Error checking URL.';
        resultEl.className = 'text-red-400 font-bold';
        console.error(err);
      }
    }
  </script>
</body>
</html>
