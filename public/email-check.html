<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Email Breach Check – CyberScan</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center min-h-screen p-4 gap-6">
  <a href="index.html" class="self-start text-gray-400 hover:text-white">← Back</a>
  <h2 class="text-3xl font-semibold">📧 Email Breach Check</h2>

  <!-- 🔍 HIBP Email Breach Check UI -->
  <div class="w-full max-w-xl p-4 bg-gray-800 rounded-xl flex flex-col gap-3 shadow-lg">
    <h3 class="text-xl font-bold text-blue-400">🔍 Check if your email was in a data breach</h3>
    <input id="emailInput" type="email" placeholder="Enter email address" class="p-3 rounded-xl text-black" />
    <button onclick="checkEmail()" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-xl shadow-lg">Scan</button>
    <div id="emailResult" class="min-h-[2rem] mt-2 text-lg font-bold"></div>
    <div id="breachCards" class="mt-4 flex flex-col gap-4"></div>
  </div>

  <script>
    async function checkEmail() {
      const email = document.getElementById("emailInput").value;
      const resultElem = document.getElementById("emailResult");
      const breachCards = document.getElementById("breachCards");

      resultElem.innerText = "";
      breachCards.innerHTML = "";

      if (!email) {
        resultElem.innerText = "❌ Please enter an email.";
        return;
      }

      try {
        const res = await fetch("https://ai-cyber-backend-1.onrender.com/check-email", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email }),
        });

        if (!res.ok) throw new Error("HIBP request failed");

        const data = await res.json();

        if (data.Breaches && data.Breaches.length > 0) {
          resultElem.innerHTML = `✅ <strong>${email}</strong> was found in <strong>${data.Breaches.length}</strong> breach(es).`;

          data.Breaches.forEach((breach) => {
            const card = document.createElement("div");
            card.className = "bg-gray-700 p-4 rounded-lg shadow-md";
            card.innerHTML = `
              <div class="flex items-center gap-4">
                <img src="${breach.LogoPath}" alt="${breach.Title}" class="w-16 h-16 object-contain bg-white p-1 rounded" />
                <div>
                  <h4 class="text-xl font-bold">${breach.Title}</h4>
                  <p class="text-sm text-gray-300">Date: ${breach.BreachDate}</p>
                </div>
              </div>
              <p class="mt-2 text-sm text-gray-200">${breach.Description}</p>
              <p class="mt-1 text-sm text-yellow-400">Exposed: ${breach.DataClasses.join(", ")}</p>
            `;
            breachCards.appendChild(card);
          });

        } else {
          resultElem.innerText = "✅ No breach found.";
        }
      } catch (err) {
        console.error("❌ Error:", err);
        resultElem.innerText = "❌ Error checking email.";
      }
    }
  </script>
</body>
</html>
